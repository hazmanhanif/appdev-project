{% extends 'base.html' %}
{% block title %}finance||payment{% endblock %}
{% block content %}

<header class="bg-gradient-to-r from-blue-900 to-indigo-900 text-white py-10">
    <h1 class="text-4xl font-semibold text-center">Welcome to SMK ORKID DESA Finance Payment Page</h1>
    <a href="{% url 'homeapp:finance_index' %}?botId={{ bot_id }}" class="block mx-auto mt-5 bg-indigo-500 hover:bg-indigo-600 text-white font-semibold rounded-md py-3 w-2/5 text-center">
        Go to Finance Dashboard
    </a>
</header>

{% if messages %}
    <div class="bg-green-200 p-4 text-center text-green-800 my-6">
        <ul>
            {% for message in messages %}
                <li>{{ message }}</li>
            {% endfor %}
        </ul>
    </div>
{% endif %}

<div class="container mx-auto py-10 px-6 text-gray-800">
    <div class="grid grid-cols-1 gap-6">
        {% for class_data in class_students_payments %}
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-xl font-semibold">{{ class_data.class_obj.classname }}</h2>
                {% for student_data in class_data.class_students %}
                    <div class="border border-gray-300 rounded-lg p-4 mt-4">
                        <h3 class="text-lg font-semibold">{{ student_data.student.username }}</h3>
                        <ul class="mt-2 grid grid-cols-1 gap-4">
                            {% for payment in student_data.payments %}
                                <li class="bg-gray-100 rounded-md p-4">
                                    <p><strong>Payment ID:</strong> {{ payment.id }}</p>
                                    <p><strong>Amount:</strong> {{ payment.paying_amount }}</p>
                                    <p><strong>Date:</strong> {{ payment.application_date }}</p>
                                    <p><strong>Payslip:</strong>
                                        <a href="{{ payment.payslip.url }}" target="_blank" class="text-blue-600 hover:underline">View Payslip</a>
                                    </p>
                                    <p><strong>Status:</strong>
                                        {% if payment.is_pending %}
                                            Pending
                                            <form action="{% url 'homeapp:finance_payment' %}" method="post" class="inline">
                                              {% csrf_token %}
                                              <input type="hidden" name="payment_id" value="{{ payment.id }}">
                                              <button type="submit" name="is_approved" value="1" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded mr-2" onclick="return confirm('Confirm the approval')">Approve</button>
                                              <button type="submit" name="is_rejected" value="1" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded" onclick="return confirm('Confirm the rejection')">Reject</button>
                                            </form>
                                        {% elif payment.is_approved %}
                                            Approved
                                        {% elif payment.is_rejected %}
                                            Rejected
                                        {% else %}
                                            Status not available
                                        {% endif %}
                                    </p>
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                {% endfor %}
            </div>
        {% endfor %}
    </div>
</div>

{% endblock %}
