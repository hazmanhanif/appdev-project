{% extends 'base.html' %}
{% block title %}finance||payment{% endblock %}
{% block content %}

{% if messages %}
        <div class="bg-green-200 p-2 text-center text-stone-800">
            <ul>
                {% for message in messages %}
                <li>{{ message }}</li>
                {% endfor %}
            </ul>
        </div>
{% endif %}

<div class="container mx-auto bg-gray-300 py-10 px-10 text-gray-800 min-h-screen flex flex-col justify-center items-center rounded-2xl shadow-md">
    <div class="grid grid-cols-2 gap-6">
        {% for class_data in class_students_payments %}
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h2 class="text-xl font-semibold">{{ class_data.class_obj.classname }}</h2>
                {% for student_data in class_data.class_students %}
                    <div class="border border-gray-300 rounded-lg p-4 mt-4">
                        <h3 class="text-lg font-semibold">{{ student_data.student.username }}</h3>
                        <ul class="mt-2 grid grid-cols-1 gap-4">
                            {% for payment in student_data.payments %}
                                <li class="bg-gray-100 rounded-md p-4">
                                    <p><strong>Payment ID:</strong> {{ payment.id }}</p>
                                    <p><strong>Amount:</strong> {{ payment.paying_amount }}</p>
                                    <p><strong>Date:</strong> {{ payment.application_date }}</p>
                                    <p><strong>Payslip:</strong>
                                        <a href="{{ payment.payslip.url }}" target="_blank" class="text-blue-600 hover:underline">View Payslip</a>
                                    </p>
                                    <p><strong>Status:</strong>
                                        {% if payment.is_pending %}
                                            Pending
                                            <form action="{% url 'homeapp:finance_payment' %}" method="post" class="inline">
                                              {% csrf_token %}
                                              <input type="hidden" name="payment_id" value="{{ payment.id }}">
                                              <button type="submit" name="is_approved" value="1" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded mr-2" onclick="return confirm('Confirm the approval')">Approve</button>
                                              <button type="submit" name="is_rejected" value="1" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded" onclick="return confirm('Confirm the rejection')">Reject</button>
                                            </form>
                                        {% elif payment.is_approved %}
                                            Approved
                                        {% elif payment.is_rejected %}
                                            Rejected
                                        {% else %}
                                            Status not available
                                        {% endif %}
                                    </p>
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                {% endfor %}
            </div>
        {% endfor %}
    </div>
</div>

{% endblock %}
